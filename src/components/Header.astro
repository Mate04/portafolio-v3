---
import { getLangFromUrl, useTranslations } from "../utils/languaje.utils";
import Button from "./Button.astro";
export interface Props {
  informacion: string;
}

const { informacion } = Astro.props;
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

---

<header class="mb-8">
  <div
    class="flex flex-col md:flex-row md:items-center md:justify-between gap-4"
  >
    <div>
      <h1 class="text-4xl font-bold text-gray-900 mb-2">Mateo Maldonado</h1>
      <p class="text-xl text-gray-600 mb-4">
        {t('title')}
      </p>
      <p class="text-gray-700 max-w-2xl">
        {informacion}
      </p>
    </div>
    <Button id="btn-download-cv" variant="default" size="lg" class="w-fit gap-2 px-6 font-bold print:hidden">{t('dowload')}</Button>
  </div>
</header>

<script>
  // Imprimir/descargar CV sin redirigir: usa iframe oculto
  (function() {
    if (typeof window === 'undefined') return;
    const btn = document.getElementById('btn-download-cv');
    if (!btn) return;

    const currentPath = window.location.pathname.replace(/\/$/, '');
    const parts = currentPath.split('/').filter(Boolean);
    const locale = parts[0] || 'es';
    const cvPath = `/${locale}/cv`;

    function printHiddenCV() {
      // Si ya estamos en la página del CV imprimimos directamente
      if (currentPath === cvPath) {
        window.print();
        return;
      }

      let iframe = document.getElementById('cv-print-frame');
      if (!iframe) {
        iframe = document.createElement('iframe');
        iframe.id = 'cv-print-frame';
        iframe.style.position = 'fixed';
        iframe.style.width = '0';
        iframe.style.height = '0';
        iframe.style.border = '0';
        iframe.style.visibility = 'hidden';
        document.body.appendChild(iframe);
      }
      // Añadimos timestamp para evitar cache y query para auto-print
      iframe.setAttribute('src', cvPath + '?print=1&embedded=1&ts=' + Date.now());
    }

    btn.addEventListener('click', (e) => {
      e.preventDefault();
      printHiddenCV();
    });
  })();
</script>